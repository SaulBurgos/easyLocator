/*!
 * jQuery easyLocator v2.0
 * https://github.com/SaulBurgos/easyLocator
 *
 * Copyright Saul Burgos
 * http://saulburgos.com/
 *
 * Date: 31/08/2016
 */

!function(a){var b=this,c=a.Deferred();this.easyLocatorMethods={locations:[],onEvents:c.promise(),locationActive:null,htmlPlug:'<div class="locatorMap_loader">Loading...</div><div id="mapContainer_map" class="locatorMap_map"></div><div class="locatorMap_listContainer locatorMap_list--desktop js-locatorMap_listContainerDesktop"><div class="locatorMap_listContainer_filter">  <input class="locatorMap_listContainer_filter_input" type="text" placeholder="filter.."></div><ul class="locatorMap_list js-locatorMap_list"></ul></div><div class="locatorMap_listContainer locatorMap_list--mobile js-locatorMap_listContainerMobile" style="display:none"><div class="locatorMap_list_close js-locatorMap_list_Close"><i class="fa fa-chevron-down"></i></div><ul class="locatorMap_list"></ul></div><div class="locatorMap_template"></div>',options:{mapContainer:void 0,map:void 0,mapOptions:void 0,isAPIloaded:!1,myLocations:[],openInfowindowAfterClick:!1,showListOnDesktop:!0,showListOnMobile:!0,itemListActiveCustomClass:"",infoWindowCustomClass:"",contentTemplate:"",useMarkerCluster:!1,mapType:void 0,centerMapOnLocation:!0,markerClustererOptions:{maxZoom:12}},loadScripts:function(a){this.showHideLoader("show");var c="https://maps.googleapis.com/maps/api/js?libraries=places&signed_in=true&language=en&callback=window.easyLocatorMethods.loadMap",d=document.createElement("link");d.rel="stylesheet",d.href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css";var e=document.getElementsByTagName("link")[0];if(e.parentNode.insertBefore(d,e),"object"==typeof google&&"object"==typeof google.maps)b.easyLocatorMethods.options.isAPIloaded=!0,this.loadMap();else{"undefined"!=typeof this.options.apiKey&&(c="https://maps.googleapis.com/maps/api/js?libraries=places&signed_in=true&language=en&key="+this.options.apiKey+"&callback=window.easyLocatorMethods.loadMap");var f=document.createElement("script");f.type="text/javascript",f.src=c,document.body.appendChild(f)}},loadMap:function(){b.easyLocatorMethods.triggerEvent({eventName:"loadingMap",data:{}}),this.options.isAPIloaded=!0;var a;a="undefined"==typeof this.options.mapOptions?{zoom:8,center:new google.maps.LatLng(-34.397,150.644),mapTypeId:google.maps.MapTypeId.ROADMAP}:this.options.mapOptions,this.options.map=new google.maps.Map(document.getElementById("mapContainer_map"),a),this.options.map.controls[google.maps.ControlPosition.TOP_CENTER].push(this.createButtonList()),this.options.markerClusterer=new MarkerClusterer(this.options.map,null,this.options.markerClustererOptions),google.maps.event.addListenerOnce(this.options.map,"idle",function(){return b.easyLocatorMethods.triggerEvent({eventName:"mapLoaded",data:{}}),"undefined"!=typeof b.easyLocatorMethods.options.spreadsheetId?void b.easyLocatorMethods.getJsonData():void(b.easyLocatorMethods.options.myLocations.length>0&&b.easyLocatorMethods.loadMyLocations())}),""==this.options.contentTemplate&&(this.options.infoWindow=new google.maps.InfoWindow({maxWidth:400}),google.maps.event.addListener(this.options.infoWindow,"closeclick",function(){b.easyLocatorMethods.removeAllIconsActive(),b.easyLocatorMethods.triggerEvent({eventName:"infoWindowClosed",data:{}})}))},createEvents:function(){a(".js-locatorMap_list_Close").on("click",function(){a(".js-locatorMap_listContainerMobile").slideToggle("fast")}),a(".locatorMap_listContainer_filter_input").change(function(){b.easyLocatorMethods.filterList(this)}).keyup(function(){b.easyLocatorMethods.filterList(this)})},filterList:function(b){var c=a(b).val();""!=c?(a(".js-locatorMap_list").find('.locatorMap_list_item_title:not(:contains_("'+c+'"))').parent().slideUp(),a(".js-locatorMap_list").find('.locatorMap_list_item_title:contains_("'+c+'")').parent().slideDown()):a(".js-locatorMap_list").find("li").slideDown()},createButtonList:function(c){if(b.easyLocatorMethods.options.showListOnMobile){var d=a.parseHTML('<div id="locatorMap_openList"><i class="fa fa-list"></i></div>')[0];return google.maps.event.addDomListener(d,"click",function(){a(".js-locatorMap_listContainerMobile").slideToggle("fast")}),d}},showHideLoader:function(b){"show"==b?a(".locatorMap_loader").show():a(".locatorMap_loader").hide()},getJsonData:function(){var a=document.createElement("script");a.type="text/javascript",a.src="https://spreadsheets.google.com/feeds/list/"+this.options.spreadsheetId+"/od6/public/values?hl=en_US&alt=json&callback=window.easyLocatorMethods.successGetJsonData",a.async=!0,document.body.appendChild(a)},getContentITemList:function(a,b,c){"undefined"!=typeof c.gsx$iconmarker&&(c.iconMarker=c.gsx$iconmarker.$t);var d='<li class="locatorMap_list_item" data-indexarray="'+a+'" data-isactive="false"><span class="ocatorMap_list_itemPlaceHolder"></span> <span class="locatorMap_list_item_title">'+b+"</span></li>";return""!=c.iconMarker&&"undefined"!=typeof c.iconMarker||(d=d.replace('<span class="ocatorMap_list_itemPlaceHolder"></span>','<i class="locatorMap_list_item_icon fa fa-map-marker"></i>')),""!=c.iconMarker&&(d=d.replace('<span class="ocatorMap_list_itemPlaceHolder"></span>','<img src="'+c.iconMarker+'" class="locatorMap_list_item_iconImage" />')),d},successGetJsonData:function(b){var c=a(".locatorMap_list");c.empty();for(var d="",e=0;e<b.feed.entry.length;e++){var f=b.feed.entry[e];d+=this.getContentITemList(e,f.gsx$title.$t,f);var g=new google.maps.Marker({position:new google.maps.LatLng(f.gsx$lat.$t,f.gsx$lng.$t),map:this.options.map,title:f.gsx$title.$t});""!=f.gsx$iconmarker.$t&&g.setOptions({icon:{url:f.gsx$iconmarker.$t,scaledSize:new google.maps.Size(32,32)}}),this.locations.push({index:e,title:f.gsx$title.$t,description:f.gsx$description.$t,image:f.gsx$image.$t,link:f.gsx$link.$t,iconMarker:f.gsx$iconmarker.$t,iconMarkerActive:f.gsx$iconmarkeractive.$t,marker:g,active:!1}),this.options.useMarkerCluster&&this.options.markerClusterer.addMarker(g)}this.loadItemsOnList(c,d)},loadMyLocations:function(){var b=a(".locatorMap_list");b.empty();for(var c="",d=0;d<this.options.myLocations.length;d++){var e=this.options.myLocations[d];c+=this.getContentITemList(d,e.title,e);var f=new google.maps.Marker({position:new google.maps.LatLng(e.lat,e.lng),map:this.options.map,title:e.title});"undefined"!=typeof e.iconMarker&&f.setOptions({icon:{url:e.iconMarker,scaledSize:new google.maps.Size(32,32)}}),this.locations.push({index:d,title:e.title,description:e.description,image:e.image,link:e.link,iconMarker:e.iconMarker,iconMarkerActive:e.iconMarkerActive,marker:f,active:!1}),this.options.useMarkerCluster&&this.options.markerClusterer.addMarker(f)}this.loadItemsOnList(b,c)},loadItemsOnList:function(a,c){a.html(c),b.easyLocatorMethods,this.attachEventLocations(),this.showHideLoader("hide"),this.options.centerMapOnLocation&&this.centerMapOnLocations()},centerMapOnLocations:function(){for(var a=new google.maps.LatLngBounds,b=0;b<this.locations.length;b++)a.extend(this.locations[b].marker.getPosition());this.options.map.fitBounds(a)},attachEventLocations:function(){function c(c){google.maps.event.addListener(c.marker,"click",function(){""==b.easyLocatorMethods.options.contentTemplate?b.easyLocatorMethods.openInfoWindow(c):b.easyLocatorMethods.openTemplate(c),b.easyLocatorMethods.setIconsActiveOnItem({elementClicked:a(".locatorMap_list_item")[c.index],location:c}),b.easyLocatorMethods.triggerEvent({eventName:"locationClicked",data:c})})}for(var d=0;d<this.locations.length;d++)c(this.locations[d]);a(".locatorMap_list_item").on("click",function(){b.easyLocatorMethods.removeAllIconsActive(),a(".locatorMap_list_item").removeClass(b.easyLocatorMethods.options.itemListActiveCustomClass);var c=b.easyLocatorMethods.locations[a(this).attr("data-indexarray")];b.easyLocatorMethods.options.map.setCenter(c.marker.getPosition()),b.easyLocatorMethods.options.openInfowindowAfterClick&&""==b.easyLocatorMethods.options.contentTemplate&&b.easyLocatorMethods.openInfoWindow(c),""!=b.easyLocatorMethods.options.contentTemplate&&b.easyLocatorMethods.openTemplate(c),a(window).width()<=768&&a(".js-locatorMap_listContainerMobile").slideToggle("fast"),""!=b.easyLocatorMethods.options.itemListActiveCustomClass&&a(this).addClass(b.easyLocatorMethods.options.itemListActiveCustomClass),b.easyLocatorMethods.setIconsActiveOnItem({elementClicked:this,location:c}),b.easyLocatorMethods.triggerEvent({eventName:"locationClicked",data:c})}),a(this.options.mapContainer).on("click",".locatorMap_template_close",function(){b.easyLocatorMethods.closeTemplate()})},setIconsActiveOnItem:function(b){a(b.elementClicked).addClass("locatorMap_list_item--active"),a(b.elementClicked).attr("data-isactive","true"),b.location.active=!0,""!=b.location.iconMarkerActive&&"undefined"!=typeof b.location.iconMarkerActive&&(a(b.elementClicked).find("img").attr("src",b.location.iconMarkerActive),b.location.marker.setOptions({icon:{url:b.location.iconMarkerActive,scaledSize:new google.maps.Size(42,42)}}))},removeAllIconsActive:function(){a(".locatorMap_list_item[data-isactive=true]").each(function(c){var d=b.easyLocatorMethods.locations[a(this).attr("data-indexarray")];a(this).removeClass("locatorMap_list_item--active"),d.active=!1,""!=d.iconMarker&&"undefined"!=typeof d.iconMarker?(a(this).find("img").attr("src",d.iconMarker),d.marker.setIcon({url:d.iconMarker,scaledSize:new google.maps.Size(32,32)})):d.marker.setIcon(null)})},openTemplate:function(b){var c=_.template(this.options.contentTemplate),d=a(this.options.mapContainer).find(".locatorMap_template");d.html(c(b)),d.show()},triggerEvent:function(a){c.notify(a)},closeTemplate:function(){a(this.options.mapContainer).find(".locatorMap_template").hide(),b.easyLocatorMethods.triggerEvent({eventName:"templateClosed",data:{}})},openInfoWindow:function(a){var c="",d="";this.locationActive=a,""!=a.link&&(c='<p><a href="'+a.link+'" target="_blank">View</a></p>'),""!=a.image&&(d='<img src="'+a.image+'" class="locatorMap_responsiveImg"/>');var e='<div id="locatorMap_contentInfoWindow" class="'+b.easyLocatorMethods.options.infoWindowCustomClass+' ">'+d+'<p class="locatorMap_contentInfoWindow_title"><b>'+a.title+"</b></p><p>"+a.description+"</p>"+c+"</div>";this.options.infoWindow.setContent(e),this.options.infoWindow.open(this.options.map,a.marker)},getMapInstance:function(){return this.options.map}},a.fn.easyLocator=function(c){return jQuery.expr[":"].contains_=function(a,b,c){return(a.textContent||a.innerText||"").toUpperCase().indexOf(c[3].toUpperCase())>=0},this.addClass("locatorMap"),this.html(b.easyLocatorMethods.htmlPlug),b.easyLocatorMethods.options=a.extend(b.easyLocatorMethods.options,c),b.easyLocatorMethods.options.mapContainer=this,b.easyLocatorMethods.loadScripts(),b.easyLocatorMethods.createEvents(),b.easyLocatorMethods.options.showListOnDesktop||(a("#mapContainer_map").addClass("locatorMap_map--fullWidth"),a(".js-locatorMap_listContainerDesktop").hide()),b.easyLocatorMethods}}(jQuery);